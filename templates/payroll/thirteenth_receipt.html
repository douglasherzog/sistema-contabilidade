{% extends 'base.html' %}
{% block title %}Recibo 13º - {{ employee.full_name }}{% endblock %}
{% block content %}
<div class="lav-page-header d-print-none">
  <div class="lav-section-title">
    <div>
      <h1 class="h4 mb-1 lav-page-title">Recibo 13º Salário</h1>
      <div class="small lav-subtitle">{{ employee.full_name }} · {{ t.reference_year }}</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{{ url_for('payroll.employee_thirteenth', employee_id=employee.id) }}">Voltar</a>
      <button class="btn btn-primary" type="button" onclick="window.print()">Imprimir</button>
    </div>
  </div>

  <div class="lav-callout mt-3">
    <strong>Didático / CLT</strong>
    <div class="small">Este recibo segue o cálculo da CLT: (salário / 12) × meses trabalhados. Descontos INSS/IRRF aplicam-se na 2ª parcela ou no integral.</div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-lg-6">
        <div class="lav-panel h-100">
          <div class="fw-bold mb-2">Dados</div>
          <div class="lav-kv"><span class="lav-meta">Funcionário</span><strong>{{ employee.full_name }}</strong></div>
          <div class="lav-kv"><span class="lav-meta">Ano de referência</span><strong>{{ t.reference_year }}</strong></div>
          <div class="lav-kv"><span class="lav-meta">Tipo</span><strong>
            {% if t.payment_type == '1st_installment' %}1ª parcela
            {% elif t.payment_type == '2nd_installment' %}2ª parcela
            {% else %}Integral{% endif %}
          </strong></div>
          <div class="lav-kv"><span class="lav-meta">Meses trabalhados</span><strong>{{ t.months_worked }}</strong></div>
          <div class="lav-kv"><span class="lav-meta">Pagamento</span><strong>{{ t.pay_date|fmt_date }}</strong></div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="lav-panel h-100">
          <div class="fw-bold mb-2">Cálculo (CLT)</div>
          <div class="small lav-subtitle mb-2">Fórmula: (salário / 12) × meses trabalhados.</div>

          <div class="lav-kv"><span>Salário usado</span><strong>R$ {{ '%.2f'|format(t.base_salary_at_calc or 0) }}</strong></div>
          <div class="lav-kv"><span>1/12 do salário</span><strong>R$ {{ '%.2f'|format(t.gross_amount / t.months_worked if t.months_worked else 0) }}</strong></div>
          <div class="lav-kv"><span class="fw-bold">Total bruto ({{ t.months_worked }}/12)</span><strong>R$ {{ '%.2f'|format(t.gross_amount or 0) }}</strong></div>

          <div class="mt-2">
            <div class="fw-bold mb-1">Descontos (estimativa)</div>
            {% if has_tables and t.inss_est is not none and t.irrf_est is not none %}
              <div class="lav-kv"><span>INSS (estimado)</span><strong>R$ {{ '%.2f'|format(t.inss_est or 0) }}</strong></div>
              <div class="lav-kv"><span>IRRF (estimado)</span><strong>R$ {{ '%.2f'|format(t.irrf_est or 0) }}</strong></div>
              <div class="lav-kv"><span class="fw-bold">Líquido (estimado)</span><strong>R$ {{ '%.2f'|format(t.net_est or 0) }}</strong></div>
              <div class="lav-meta mt-2">INSS: {{ inss_eff|fmt_date }} · IRRF: {{ irrf_eff|fmt_date }}</div>
            {% else %}
              <div class="text-muted small">
                {% if t.payment_type == '1st_installment' %}
                  1ª parcela: sem descontos (conforme CLT).
                {% else %}
                  Para calcular estimativas de INSS/IRRF, configure as tabelas em <strong>Config INSS/IRRF</strong>.
                {% endif %}
              </div>
            {% endif %}
          </div>

          {% if clt_warnings %}
          <div class="alert alert-warning mt-3">
            <div class="fw-bold mb-1">Avisos CLT:</div>
            {% for w in clt_warnings %}
            <div class="small">• {{ w }}</div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <hr class="my-4">

    <div class="fw-bold mb-2">Assinaturas</div>
    <div class="row g-2">
      <div class="col-12">
        <div class="border-bottom lav-signature-line"></div>
        <div class="small text-muted">Assinatura do funcionário</div>
      </div>
      <div class="col-12">
        <div class="border-bottom lav-signature-line"></div>
        <div class="small text-muted">Assinatura do responsável</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
